# This function is complex and depends on other modules.
# You will need to translate the dependencies and logic step by step.